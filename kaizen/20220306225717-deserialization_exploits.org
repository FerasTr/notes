:PROPERTIES:
:ID:       55b63f1c-3f9d-4200-b893-4158869dc846
:END:
#+title: Deserialization Exploits

* PHP
** Serialized Structure
From the following code snippet:
#+begin_src php
<?php
class User{
    public $username;
    public $status;
}
$user = new User;
$user->username = 'vickie';
$user->status = 'not admin';echo serialize($user);?>
#+end_src
We get the following string which represents a "User" object:
#+begin_example
O:4:"User":2:{s:8:"username";s:6:"vickie";s:6:"status";s:9:"not admin";}
#+end_example

The structure of the above string follows the schema "type:data".
- b:boolean
- i:int
- d:float
- s:length:string
- a:number of elements:{elements}
- O:length of name:class name:number of properties:{properties}

** Unserialize and Magic Methods
The magic methods that are relevant for us now are ~__wakeup()~ and ~__destruct()~. If the class of the serialized object implements any method named ~__wakeup()~ or ~__destruct()~, these methods will be executed automatically when ~unserialize()~ is called on an object.

To exploit such functions, we can change the value (and its corresponding type/length) of the serialized object.

* Resources
- [[https://medium.com/swlh/exploiting-php-deserialization-56d71f03282a][Exploiting PHP deserialization]]
